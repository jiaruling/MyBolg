---
title: "合约之间的调用"
date: 2024-05-10T16:07:35+08:00
lastmod: 2024-05-10T16:07:35+08:00
author: ["me"]
categories: ["web3"] # 没有分类界面可以不填写
tags: [""] # 标签
description: ""
weight:
slug: ""
draft: false # 是否为草稿
comments: true # 本页面是否显示评论
reward: true # 打赏
mermaid: true #是否开启mermaid
showToc: true # 显示目录
TocOpen: true # 自动展开目录
hidemeta: false # 是否隐藏文章的元信息，如发布日期、作者等
disableShare: true # 底部不显示分享栏
showbreadcrumbs: true #顶部显示路径
#   cover:
#     image: "" #图片路径例如：posts/tech/123/123.png
#     zoom: # 图片大小，例如填写 50% 表示原图像的一半大小
#     caption: "" #图片底部描述
#     alt: ""
#     relative: false
---

## 原理

> EOA(External owned account), 外部账号，例如 metamask。调用最终是由EOA发起的

![](/image/contractCall.png)

### 调用过程

- 调用者必须持有被调用合约的地址
- 得到被调用合约的信息
- 将地址重载为被调用合约，调用它的函数

## 静态调用

### 在源文件内部

- 调用者直接将被调用合约的地址重载为合约实例
- 用合约实例调用合约函数

在源文件`FunctionCallSameFile.sol`中输入以下代码:

```solidity

// SPDX-License-Identifier: GPL-3.0

pragma solidity >=0.8.2 <0.9.0;

// 先部署,得到Callee的合约地址
contract Callee {
    uint public x;
    function setX(uint _x) public {
        x = _x;
    }
}

// 后部署，部署时要初始化Callee的合约地址
contract Caller {
    address calleeAddress;
    
    constructor(address _calleeAddress) {
        calleeAddress = _calleeAddress;
    }

    function setCalleeX(uint _x) public {
        Callee callee = Callee(calleeAddress); // 将合约地址重载为合约实例
        callee.setX(_x); // 通过合约实例调用合约函数
    }
}
```

### 在源文件之间

- import导入被调用合约的源文件
- 调用者将被调用合约的地址重载为合约实例
- 用合约实例调用合约函数

先部署源文件`Callee.sol`

```solidity
// SPDX-License-Identifier: GPL-3.0

pragma solidity >=0.8.2 <0.9.0;

contract Callee {
    uint public x;
    function setX(uint _x) public {
        x = _x;
    }
}
```

再部署源文件`Caller.sol`

```solidity
// SPDX-License-Identifier: GPL-3.0

pragma solidity >=0.8.2 <0.9.0;

import "contracts/Callee.sol"; // 导入被调用的合约

contract Caller {
    address calleeAddress;
    
    constructor(address _calleeAddress) {
        calleeAddress = _calleeAddress;
    }

    function setCalleeX(uint _x) public {
        Callee callee = Callee(calleeAddress);  // 将合约地址重载为合约实例
        callee.setX(_x); // 通过合约实例调用合约函数
    }
}
```



## 动态调用

